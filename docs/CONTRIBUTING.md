# Contributing

## Prerequisites

### GitHub account

Before getting started to contribute, [sign up](https://github.com/signup) for GitHub account.

### Code of Conduct

Please make sure to read the [Code of Conduct](/docs/CODE_OF_CONDUCT.md).

### Security Policy

Please make sure to read the [Security Policy](/docs/SECURITY.md) in the case you find some security issues.

## Workflows overview

1. Fork this repository.
2. Clone the forked repository with `git clone CLONED_REPO_URL`.
3. Enter the working directory with `cd CLONED_REPO_NAME`
4. Checkout the new development branch with `git checkout -b DEVELOPMENT_BRANCH_NAME`.
5. Some changes.

Once you finished our changes,

1. Commit your change with `git commit -S -m "YOUR_COMMIT_MESSAGE"`.
2. Push the changes with `git push -u origin DEVELOPMENT_BRANCH_NAME`.
3. Send a PR to this repository.

## Developing

### Setting up development environment

### Install GO

Install [GO](https://go.dev/doc/install).
The GO version used can be found in [go.mod](/go.mod).

Make sure that `go` command is available on your environment.
For example, `go version` will show you the installed go version.

```sh
$ go version
go version go1.22.0 linux/amd64
```

### Install Make

Install [make](https://www.gnu.org/software/make/).

Installing make is optional but strongly recommended because we make many commands available from `make` by the [Makefile](/Makefile).
It removes complexity of development workflows.

You can check that `make` is available on your environment with `make --version`.

```sh
$ make --version
GNU Make 4.2.1
Built for x86_64-pc-linux-gnu
Copyright (C) 1988-2016 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
```

```sh
make
```

or

```sh
make help
```

will show you the available rules defined in this project.

### Install Protoc and Protovalidate

Install [protoc](https://grpc.io/docs/protoc-installation/).

Installing protoc is optional, but required when developing [APIs](/proto/).

First, [download](https://github.com/protocolbuffers/protobuf/releases) protoc and copy `bin/protoc` to, for example, `/usr/local/bin/protoc`.

```bash
sudo rm -f /usr/local/bin/protoc
sudo cp bin/protoc /usr/local/bin/
```

Copy `include/google/` to, for example, `/usr/local/include/google/`.

```bash
sudo rm -rf /usr/local/include/google/
sudo cp -r include/google/ /usr/local/include/
```

The typical directory structure will be like this.

```text
/usr/local/
├── bin/
│   └── protoc
└── include/
    └── google/
```

Make sure that the protoc is included in your `$PATH`.
You can check that `protoc` is available on your environment with `protoc --version`.

```sh
$ protoc --version
libprotoc 3.20.3
```

[protovalidate](https://github.com/bufbuild/protovalidate) is used to validate APIs.
It must be included to protoc when building go codes from proto files.
To include protovalidate, visit [bufbuild/protovalidate](https://github.com/bufbuild/protovalidate) and download the proto files in [proto/protovalidate/buf/](https://github.com/bufbuild/protovalidate/tree/main/proto/protovalidate/buf/).

Put the downloaded files to an include directory, for example, `/usr/local/include/buf/`.
The typical directory structure will be like this.

```text
/usr/local/
├── bin/
│   └── protoc
└── include/
    ├── google/
    └── buf/
```

### Building binaries from source

AILERON Gateway can be build as static binary.
So disable `CGO_ENABLED`.

```sh
# Linux
export CGO_ENABLED=0

# Windows
set CGO_ENABLED=0
```

Then, build with the command.

```bash
go build -trimpath -ldflags="-w  -s -extldflags \"-static\"" ./cmd/aileron/
```

`make` can be used instead of running go command directly if you have installed it.

```bash
make build
```

### Developing APIs

AILERON Gateway is using [Protocol Buffers](https://protobuf.dev/) to define APIs.
GO codes in [apis/](/apis/) are generated by protobuf compiler, or protoc, from `.proto` files in [proto/](/proto/).

Run the following command to generate go codes,

```sh
make proto
```

## Enhancement

See [TODO](TODO) for enhancement workflows.
